!function(t,e){"function"==typeof define&&define.amd?define(["tether"],e):"object"==typeof exports?module.exports=e(require("tether")):t.Select=e(t.Tether)}(this,function(t){"use strict";function e(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function n(){window.innerWidth,window.innerHeight;return!1}function r(t){return Array.prototype.reduce.call(t,function(t,e){return t===e&&e})}function o(){var t=document.querySelector(".select-target-focused");return t?t.selectInstance:null}var s=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),a=function(t,e,i){for(var n=!0;n;){var r=t,o=e,s=i;n=!1,null===r&&(r=Function.prototype);var a=Object.getOwnPropertyDescriptor(r,o);if(void 0!==a){if("value"in a)return a.value;var l=a.get;if(void 0===l)return;return l.call(s)}var c=Object.getPrototypeOf(r);if(null===c)return;t=c,e=o,i=s,n=!0,a=c=void 0}},l=t.Utils,c=l.extend,h=l.addClass,u=l.removeClass,d=l.hasClass,p=l.getBounds,g=l.Evented,v=13,f=27,y=32,m=38,b=40,O=("ontouchstart"in document.documentElement,"click"),k="",E=void 0;document.addEventListener("keypress",function(t){var e=o();if(e&&0!==t.charCode){t.keyCode===y&&t.preventDefault(),clearTimeout(E),E=setTimeout(function(){k=""},500),k+=String.fromCharCode(t.charCode);var i=e.findOptionsByPrefix(k);if(1===i.length&&e.selectOption(i[0]),k.length>1&&r(k)){var n=e.findOptionsByPrefix(k[0]);if(n.length){var s=n.indexOf(e.getChosen());return s+=1,s%=n.length,void e.selectOption(n[s])}}return i.length?void e.selectOption(i[0]):void 0}}),document.addEventListener("keydown",function(t){var e=o();if(e)if([m,b,f].indexOf(t.keyCode)>=0&&t.preventDefault(),e.isOpen())switch(t.keyCode){case m:case b:e.moveHighlight(t.keyCode);break;case v:e.selectHighlightedOption();break;case f:e.close(),e.target.focus()}else[m,b,y].indexOf(t.keyCode)>=0&&e.open()});var w=function(r){function o(t){if(e(this,o),a(Object.getPrototypeOf(o.prototype),"constructor",this).call(this,t),this.options=c({},o.defaults,t),this.select=this.options.el,"undefined"!=typeof this.select.selectInstance)throw new Error("This element has already been turned into a Select");this.update=this.update.bind(this),this.setupTarget(),this.renderTarget(),this.setupDrop(),this.renderDrop(),this.setupSelect(),this.setupTether(),this.bindClick(),this.bindMutationEvents(),this.value=this.select.value}return i(o,r),s(o,[{key:"useNative",value:function(){var t=this.options.useNative;return t===!0||n()&&t!==!1}},{key:"setupTarget",value:function(){var t=this;this.target=document.createElement("a"),this.target.href="javascript:;",h(this.target,"select-target");var e=this.select.getAttribute("tabindex")||0;this.target.setAttribute("tabindex",e);var i=this.select.getAttribute("hidden");i?this.target.setAttribute("hidden",i):this.target.removeAttribute("hidden");var n=getComputedStyle(this.select),r="100%",o=n.minWidth>0?"min-width:"+n.minWidth:"",s=n.maxWidth>0?"max-width:"+n.maxWidth:"";this.target.setAttribute("style","width:"+r+";"+o+";"+s),this.options.className&&h(this.target,this.options.className),this.target.selectInstance=this,this.target.addEventListener("click",function(){t.isOpen()?t.target.blur():t.target.focus()}),this.target.addEventListener("focus",function(){h(t.target,"select-target-focused")}),this.target.addEventListener("blur",function(e){var i=e.relatedTarget;t.isOpen()&&i&&!t.drop.contains(i)&&t.close(),u(t.target,"select-target-focused")}),this.select.parentNode.insertBefore(this.target,this.select.nextSibling)}},{key:"setupDrop",value:function(){var t=this;this.drop=document.createElement("div"),h(this.drop,"select"),this.options.className&&h(this.drop,this.options.className),document.body.appendChild(this.drop),this.drop.addEventListener("click",function(e){var i=e.target;d(e.target.parentElement,"select-option")&&(i=e.target.parentElement),d(i,"select-option")&&t.pickOption(i),e.stopPropagation()}),this.drop.addEventListener("mousemove",function(e){var i=e.target;d(e.target.parentElement,"select-option")&&(i=e.target.parentElement),d(i,"select-option")&&t.highlightOption(i)}),this.content=document.createElement("div"),h(this.content,"select-content"),this.drop.appendChild(this.content)}},{key:"open",value:function(){var t=this;if(h(this.target,"select-open"),this.useNative()){var e=document.createEvent("MouseEvents");return e.initEvent("mousedown",!0,!0),void this.select.dispatchEvent(e)}this.drop.setAttribute("style","width: "+this.target.clientWidth+"px"),h(this.drop,"select-open"),setTimeout(function(){t.tether.enable()});var i=this.drop.querySelector(".select-option-selected");if(i){this.highlightOption(i),this.scrollDropContentToOption(i);var n=function(){if(d(t.drop,"tether-abutted-left")||d(t.drop,"tether-abutted-bottom")){var e=p(t.drop),n=p(i),r=e.top-(n.top+n.height);t.drop.style.top=(parseFloat(t.drop.style.top)||0)+r+"px"}},r=this.options.alignToHighlighted,o=this.content,s=o.scrollHeight,a=o.clientHeight;("always"===r||"auto"===r&&s<=a)&&setTimeout(function(){n()}),this.trigger("open")}}},{key:"close",value:function(){u(this.target,"select-open"),this.useNative()&&this.select.blur(),this.tether.disable(),u(this.drop,"select-open"),this.trigger("close")}},{key:"toggle",value:function(){this.isOpen()?this.close():this.open()}},{key:"isOpen",value:function(){return d(this.drop,"select-open")}},{key:"bindClick",value:function(){var t=this;this.target.addEventListener(O,function(e){e.preventDefault(),t.toggle()}),document.addEventListener(O,function(e){t.isOpen()&&(e.target===t.drop||t.drop.contains(e.target)||e.target===t.target||t.target.contains(e.target)||t.close())})}},{key:"setupTether",value:function(){this.tether=new t(c({element:this.drop,target:this.target,attachment:"top left",targetAttachment:"bottom left",classPrefix:"select",constraints:[{to:"window",attachment:"together"}]},this.options.tetherOptions))}},{key:"renderTarget",value:function(){this.target.innerHTML="";var t=this.select.getAttribute("hidden");t?this.target.setAttribute("hidden",t):this.target.removeAttribute("hidden");for(var e=this.select.querySelectorAll("option"),i=0;i<e.length;++i){var n=e[i];if(n.selected){var r=n.innerHTML;if(r.indexOf(";")>0){var o=r.indexOf(";");r=r.substring(0,o)}this.target.innerHTML=r;break}}this.target.appendChild(document.createElement("b"))}},{key:"renderDrop",value:function(){var t=document.createElement("ul");h(t,"select-options");for(var e=this.select.querySelectorAll("option"),i=0;i<e.length;++i){var n=e[i],r=document.createElement("li");h(r,"select-option"),r.setAttribute("data-value",n.value);var o=n.innerHTML;o.indexOf(";")>0&&(o=o.replace(";","<span>"),o+="</span>"),r.innerHTML=o,n.selected&&h(r,"select-option-selected"),t.appendChild(r)}this.content.innerHTML="",this.content.appendChild(t)}},{key:"update",value:function(){this.renderDrop(),this.renderTarget()}},{key:"setupSelect",value:function(){this.select.selectInstance=this,h(this.select,"select-select"),this.select.addEventListener("change",this.update)}},{key:"bindMutationEvents",value:function(){"undefined"!=typeof window.MutationObserver?(this.observer=new MutationObserver(this.update),this.observer.observe(this.select,{childList:!0,attributes:!0,characterData:!0,subtree:!0})):this.select.addEventListener("DOMSubtreeModified",this.update)}},{key:"findOptionsByPrefix",value:function(t){var e=this.drop.querySelectorAll(".select-option");return t=t.toLowerCase(),Array.prototype.filter.call(e,function(e){return e.innerHTML.toLowerCase().substr(0,t.length)===t})}},{key:"findOptionsByValue",value:function(t){var e=this.drop.querySelectorAll(".select-option");return Array.prototype.filter.call(e,function(e){return e.getAttribute("data-value")===t})}},{key:"getChosen",value:function(){return this.isOpen()?this.drop.querySelector(".select-option-highlight"):this.drop.querySelector(".select-option-selected")}},{key:"selectOption",value:function(t){this.isOpen()?(this.highlightOption(t),this.scrollDropContentToOption(t)):this.pickOption(t,!1)}},{key:"resetSelection",value:function(){this.selectOption(this.drop.querySelector(".select-option"))}},{key:"highlightOption",value:function(t){var e=this.drop.querySelector(".select-option-highlight");e&&u(e,"select-option-highlight"),h(t,"select-option-highlight"),this.trigger("highlight",{option:t})}},{key:"moveHighlight",value:function(t){var e=this.drop.querySelector(".select-option-highlight");if(!e)return void this.highlightOption(this.drop.querySelector(".select-option"));var i=this.drop.querySelectorAll(".select-option"),n=Array.prototype.indexOf.call(i,e);if(n>=0&&(t===m?n-=1:n+=1,!(n<0||n>=i.length))){var r=i[n];this.highlightOption(r),this.scrollDropContentToOption(r)}}},{key:"scrollDropContentToOption",value:function(t){var e=this.content,i=e.scrollHeight,n=e.clientHeight,r=e.scrollTop;if(i>n){var o=p(this.content),s=p(t);this.content.scrollTop=s.top-(o.top-r)}}},{key:"selectHighlightedOption",value:function(){this.pickOption(this.drop.querySelector(".select-option-highlight"))}},{key:"pickOption",value:function(t){var e=this,i=arguments.length<=1||void 0===arguments[1]||arguments[1];this.value=this.select.value=t.getAttribute("data-value"),this.triggerChange(),i&&setTimeout(function(){e.close(),e.target.focus()})}},{key:"triggerChange",value:function(){var t=document.createEvent("HTMLEvents");t.initEvent("change",!0,!1),this.select.dispatchEvent(t),this.trigger("change",{value:this.select.value})}},{key:"change",value:function(t){var e=this.findOptionsByValue(t);if(!e.length)throw new Error('Select Error: An option with the value "'+t+"\" doesn't exist");this.pickOption(e[0],!1)}}]),o}(g);return w.defaults={alignToHighlighed:"auto",className:"select-theme-default"},w.init=function(){var t=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];if("loading"===document.readyState)return void document.addEventListener("DOMContentLoaded",function(){return w.init(t)});"undefined"==typeof t.selector&&(t.selector="select");for(var e=document.querySelectorAll(t.selector),i=0;i<e.length;++i){var n=e[i];n.selectInstance||new w(c({el:n},t))}},w});